import { ApiProperty, ApiResponseProperty } from '@nestjs/swagger';
import {
  IsString,
  IsNotEmpty,
  IsNumberString,
  IsOptional,
} from 'class-validator';
import { exampleExploit } from '../../source/example-exploit';

export class ExploitDto {
  id: string;
  name: string;
  author: string;
  description: string;
  script: string;
  targetAuthor: string;
  targetRepo: string;
  targetPath: string;
  targetRef: string;
}

export class CreateExploitDto {
  name: string;
  author: string;
  description: string;
  script: string;
  targetAuthor: string;
  targetRepo: string;
  targetPath: string;
  targetRef: string;
}

export class SearchExploitsQueryDto {
  @IsNumberString()
  @ApiProperty({ example: 1, minimum: 1, default: 1 })
  pageNo: string;

  @IsString()
  @IsOptional()
  @ApiProperty({ example: 'TimelockController vul', required: false })
  name?: string;
}

export class CreateExploitRequestDto {
  @IsString()
  @IsNotEmpty()
  @ApiProperty({ example: exampleExploit.name })
  name: string;
  @IsString()
  @IsNotEmpty()
  @ApiProperty({ example: exampleExploit.author })
  author: string;
  @IsString()
  @ApiProperty({ example: exampleExploit.description })
  description: string;
  @IsString()
  @IsNotEmpty()
  @ApiProperty({ example: exampleExploit.script })
  script: string;
  @IsString()
  @IsNotEmpty()
  @ApiProperty({ example: exampleExploit.targetAuthor })
  targetAuthor: string;
  @IsString()
  @IsNotEmpty()
  @ApiProperty({ example: exampleExploit.targetRepo })
  targetRepo: string;
  @IsString()
  @IsNotEmpty()
  @ApiProperty({ example: exampleExploit.targetPath })
  targetPath: string;
  @IsString()
  @IsNotEmpty()
  @ApiProperty({ example: exampleExploit.targetRef })
  targetRef: string;
}

export class ExploitResponseDto {
  @ApiResponseProperty({ example: '' })
  id: string;
  @ApiResponseProperty({ example: exampleExploit.name })
  name: string;
  @ApiResponseProperty({ example: exampleExploit.author })
  author: string;
  @ApiResponseProperty({ example: exampleExploit.description })
  description: string;
  @ApiResponseProperty({ example: exampleExploit.script })
  script: string;
  @ApiResponseProperty({ example: exampleExploit.targetAuthor })
  targetAuthor: string;
  @ApiResponseProperty({ example: exampleExploit.targetRepo })
  targetRepo: string;
  @ApiResponseProperty({ example: exampleExploit.targetPath })
  targetPath: string;
  @ApiResponseProperty({ example: exampleExploit.targetRef })
  targetRef: string;
}

export class ExploitNotifyJobDto {
  exploitId: string;
}

export class SearchExploitsDto {
  pageNo: number;
  name: string;
}

export class SearchExploitsResponseDto {
  @ApiProperty({ example: [{ id: '', ...exampleExploit }] })
  data: ExploitDto[];
}
